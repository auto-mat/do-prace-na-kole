{% load url from future %}
{% load dpnk_tags %}
{% load i18n %}
{% load humanize %}

{% if competitions %}
<form name="admissions" method="POST">
<input type="hidden" id="admission_competition_id" name="admission_competition_id"/>
<input type="hidden" id="cancellation_competition_id" name="cancellation_competition_id"/>
<table id="rides" class="table table-striped table-bordered table-hover table-condensed" style="max-width:539px">
   <tr>
      <th scope="column">{% trans "Závod" %}</th>
      <th scope="column">{% trans "Typ" %}</th>
      <th scope="column">{% trans "Akce" %}</th>
      <th scope="column">{% trans "Pořadí" %}</th>
      <th scope="column">{% trans "Hodnocení" %}</th>
      <th scope="column">{% trans "Počet závodníků" %}</th>
   </tr>
   {% for competition in competitions %}
      <tr>
         <td>
            {% if competition.url %}
               <a href="{{ competition.url }}" target="_blank">{{ competition }}</a>
            {% else %}
               {{ competition }}
            {% endif %}
         <td>
            {% if competition.type == 'questionnaire' %}
               dotazník
            {% elif competition.type == 'frequency' %}
               pravidelnost
            {% elif competition.type == 'length' %}
               vzdálenost
            {% endif %}
            {% if competition.competitor_type == 'single_user' %}
               jednotlivců
            {% elif competition.competitor_type == 'liberos' %}
               liberos
            {% elif competition.competitor_type == 'team' %}
               týmů
            {% elif competition.competitor_type == 'company' %}
               společností
            {% endif %}
         </td>
         <td>
            {% if competition.competitor_can_admit == True %}
            {% if competition.type == 'questionnaire' %}
               <a href="{% wp_url 'otazka' %}?questionaire={{ competition.slug }}">
                  {% if competition.competitor_has_admission %}
                     změnit odpovědi
                  {% else %}
                     vyplnit dotazník
                  {% endif %}
               </a>
            {% elif competition.type == 'frequency' or competition.type == 'length' %}
               {% if competition.competitor_has_admission %}
                  <button type="button" class="submit" onclick='$("#cancellation_competition_id").val("{{ competition.id }}")'>Odhlásit ze soutěže</button>
               {% else %}
                  <button type="button" class="submit" onclick='$("#admission_competition_id").val("{{ competition.id }}")'>Přihlásit do soutěže</button>
               {% endif %}
            {% endif %}
            {% else %}
               {% if competition.competitor_can_admit == 'without_admission' %}
                  {% trans "Do této soutěže jste přihlášen automaticky." %} 
               {% elif competition.competitor_can_admit == 'after_beginning' %}
                  {% if competition.competitor_has_admission %}
                     {% trans "Soutěž začala, již není možné se odhlásit." %} 
                  {% else %}
                     {% trans "Soutěž začala, již není možné se přihlásit." %} 
                  {% endif %}
               {% elif competition.competitor_can_admit == 'not_actual' %}
                  {% trans "Dotazník není v současné době aktivní." %} 
               {% elif competition.competitor_can_admit == 'not_team_coordinator' %}
                  {% if competition.competitor_has_admission %}
                     {% trans "Do této soutěže týmů vás přihlásil váš týmový koordnátor." %} 
                  {% else %}
                     {% trans "Do této soutěže týmů vás musí přihlásit týmový koordinátor." %} 
                  {% endif %}
               {% elif competition.competitor_can_admit == 'not_company_admin' %}
                  {% if competition.competitor_has_admission %}
                     {% trans "Do této soutěže firem vás přihlásil váš firemní správce." %} 
                  {% else %}
                     {% trans "Do této soutěže firem vás musí přihlásit váš firemní správce." %} 
                  {% endif %}
               {% else %}
                  {{ competition.competitor_can_admit }}
               {% endif %}
            {% endif %}
         </td>
         {% if competition.is_actual and competition.competitor_has_admission %}
            <td><a href="{% wp_url 'vysledky_souteze' %}?soutez={{ competition.slug }}#row-{{ competition.my_results.id }}">{{ competition.my_results.position|ordinal }}</a></td>
            <td>
               {% if competition.type == 'length' %}
                 {{ competition.my_results.result|floatformat:-1|intcomma }} Km
               {% elif competition.type == 'frequency' %}
                 {{ competition.my_results.result| percentage |floatformat:-1|intcomma }} %
               {% elif competition.type == 'questionnaire' %}
                 {{ competition.my_results.result|floatformat:-1|intcomma }}b.
               {% endif %}
            </td>
         {% else %}
            <td>-</td>
            <td>-</td>
         {% endif %}
         <td>{{ competition.competitor_count|intcomma }}</td>
      </tr>
   {% endfor %}
</table>
</form>
{% else %}
<div class="text-info">{% trans "Momentálně nejsou vypsány žádné soutěže, do kterých byste se mohl/a přihlásit" %}</div>
{% endif %}
