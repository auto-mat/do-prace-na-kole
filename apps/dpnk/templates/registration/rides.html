{% load i18n %}
{% load l10n %}
{% load dpnk_tags %}
{% load humanize %}
{% load crispy_forms_tags %}

<script type="text/javascript">
   $(function () {
      $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<form id="rides-form" name="calendar" method="POST">
{{ formset.management_form }}
<br>

{% if formset.0 %}
<table id="rides" class="table table-hover table-condensed">
<thead>
   <tr class="info">
      <th scope="col">{% trans "Do práce" %}</th>
      <th scope="col">{% trans "Z práce" %}</th>
   </tr>
</thead>
{% for trip_form in formset %}
   {% if forloop.counter0|divisibleby:2 %}
      <tr class="info">
         <th colspan="2" scope="row" class="date">
            {{ trip_form.initial.date|naturalday:"D. j.n." }}<span>{{ trip_form.initial.date|naturalday:"Y" }}</span>
         </th>
      </tr>
      <tr>
   {% endif %}
      <td>
         {% crispy trip_form %}
         {% if trip_form.instance.has_gpxfile %}
            <a class="pin" href="{% url "gpx_file" id=trip_form.instance.gpxfile.id %}" data-toggle="tooltip" data-placement="top" title="{% trans 'Zobrazit trasu nebo zadat novou' %}">
               <span class="glyphicon glyphicon-edit"></span>
            </a>
            </abbr>
         {% else %}
            <a class="pin" href="{% url "gpx_file_create" date=trip_form.instance.date direction=trip_form.instance.direction %}" data-toggle="tooltip" data-placement="top" title="{% trans 'Zadat trasu v mapě nebo nahrát GPX soubor' %}">
               <span class="glyphicon glyphicon-map-marker"></span>
            </a>
         {% endif %}
      </td>
   {% if forloop.counter|divisibleby:2 %}
   </tr>
   {% endif %}
{% endfor %}
<tr class="info">
   <th colspan="2">
      <strong>
      {% trans "Celkem" %}
      </strong>
   </th>
</tr>
<tr class="info">
   <td colspan="2">
      {% trans "Ujetá započítaná vzdálenost" %}: {{ user_attendance.trip_length_total }}&nbsp;km (<a href="{% url "rides_details" %}">{% trans "Podrobný přehled jízd" %}</a>)
      <br/>
      {% trans "Pravidelnost" %}: {{ user_attendance.get_frequency_percentage|intcomma }}&nbsp;%
      <br/>
      {% trans "Ušetřené množství oxidu uhličitého" %}: {{ user_attendance.get_emissions.co2|intcomma }}&nbsp;g  (<a href="{% url 'emission_calculator' %}">{% trans "Emisní kalkulačka" %}</a>)
   </td>
</tr>
</table>
<input type="submit" name="submit" value="{% trans "Odeslat" %}" class="btn btn-primary btn-block" id="submit-id-submit">
{% else %}
<div class="alert alert-info">
{% trans "Zde budete zadávat vaše jízdy" %}
</div>
{% endif %}
</form>
<div></div>
